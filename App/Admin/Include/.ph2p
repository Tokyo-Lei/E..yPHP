<?php
session_start();
define('IS_MyPHP', TRUE);

//定义根目录
define('ROOT_PATH',dirname(__FILE__));
//加载配置
require_once(ROOT_PATH . '/../Admin_config.php');

//如果用户空提交，返回重登录

if(!isset($_SESSION['username'])){
    echo "<script>window.location.href='$admin_url./Admin_login.php';</script>";
    exit();
}


// 调用common_helper中的文件上传方法
$info = upload_file(UPLOAD_PATH.'Uploads/');
$info['file'] = $this->config->config['base_url'].$info['file'];

echo json_encode($info);
exit;


function upload_file($targetFolder = null){
    $tempFile = $_FILES['filename']['tmp_name'];
    $targetPath = $_SERVER['DOCUMENT_ROOT'] . $targetFolder;
    $fileParts = pathinfo($_FILES['filename']['name']);
    $extension = $fileParts['extension'];
    $name = get_rand() . '.' . $extension;

    $targetFile = rtrim($targetPath,'/') . '/'.  $name;
    move_uploaded_file($tempFile,$targetFile);

    $data['size'] = abs(filesize($targetFile));
    $data['file'] = $targetFolder . $name;
    $data['tmp_name'] = $fileParts['filename'];
    return $data;
}




?>